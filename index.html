<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcript Parser</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>Transcript Parser</h1>
                </div>
                <div class="auth-section" id="authSection">
                    <div class="auth-user" id="authUser" style="display: none;">
                        <span class="user-email" id="userEmail"></span>
                        <button class="btn btn-small btn-secondary" id="settingsBtn">Settings</button>
                        <button class="btn btn-small btn-secondary" id="logoutBtn">Logout</button>
                    </div>
                    <div class="auth-buttons" id="authButtons">
                        <button class="btn btn-small btn-primary" id="loginBtn">Login</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-grid">
            <!-- Area 1: File Upload Zone -->
            <div class="panel upload-panel">
                <h2>Upload Files</h2>
                <div class="upload-zone" id="uploadZone">
                    <svg class="upload-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <p>Drag & drop PDF files here</p>
                    <p class="upload-subtext">or click to browse</p>
                    <input type="file" id="fileInput" accept=".pdf" multiple hidden>
                </div>
                <div class="file-list" id="fileList">
                    <!-- Uploaded files will appear here -->
                </div>
            </div>

            <!-- Area 2: Prompt Input Zone -->
            <div class="panel prompt-panel">
                <h2>Prompt</h2>
                <div class="prompt-name-input">
                    <input
                        type="text"
                        id="promptNameInput"
                        class="prompt-name-field"
                        placeholder="Prompt name (for saving)..."
                    >
                    <div class="prompt-actions">
                        <button class="btn btn-small" id="savePromptBtn">Save</button>
                        <button class="btn btn-small btn-danger" id="deletePromptBtn">Delete</button>
                    </div>
                </div>
                <textarea
                    id="promptInput"
                    class="prompt-textarea"
                    placeholder="Enter your prompt here...&#10;&#10;Example: Please summarize this earnings call transcript, highlighting key financial metrics, management commentary, and any forward-looking guidance."
                ></textarea>
                <div class="saved-prompts-buttons" id="savedPromptsButtons">
                    <!-- Saved prompt buttons will appear here -->
                </div>
            </div>

            <!-- Area 3: Control & Results Zone -->
            <div class="panel results-panel">
                <h2>Process & Results</h2>
                <div class="model-settings">
                    <div class="model-setting-group">
                        <label for="providerSelect">LLM Provider</label>
                        <select id="providerSelect" class="form-control">
                            <option value="gemini">Gemini</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Claude</option>
                        </select>
                    </div>
                    <div class="model-setting-group">
                        <label for="modelInput">Model Name (optional)</label>
                        <input type="text" id="modelInput" class="form-control" placeholder="e.g., gpt-5.1, gemini-3-pro-preview, claude-opus-4-5-20250929">
                        <span class="form-hint">Leave blank for default model</span>
                    </div>
                </div>
                <div class="control-buttons">
                    <button class="btn btn-primary" id="parseBtn">Parse Transcripts</button>
                    <button class="btn btn-secondary" id="clearBtn">Clear All</button>
                </div>
                <div class="results-container" id="resultsContainer">
                    <p class="empty-state">Upload files and click "Parse Transcripts" to begin</p>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast"></div>

        <!-- Auth Modal -->
        <div class="modal" id="authModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="authModalTitle">Login</h2>
                    <button class="modal-close" id="authModalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="authForm">
                        <div class="form-group">
                            <label for="authEmail">Email</label>
                            <input type="email" id="authEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="authPassword">Password</label>
                            <input type="password" id="authPassword" class="form-control" required minlength="6">
                            <span class="form-hint">Minimum 6 characters</span>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" id="authSubmitBtn">Login</button>
                        </div>
                    </form>
                    <div class="auth-toggle">
                        <span id="authToggleText">Don't have an account?</span>
                        <button class="btn-link" id="authToggleBtn">Sign up</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal">
            <div class="modal-content modal-wide">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="modal-close" id="settingsModalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <h3 class="settings-section-title">Your API Keys</h3>
                    <p class="settings-description">Add your own API keys to use instead of the default keys. Your keys are encrypted and stored securely.</p>

                    <div class="api-key-form">
                        <div class="api-key-row">
                            <div class="api-key-provider">
                                <label>OpenAI</label>
                                <span class="api-key-status" id="openaiKeyStatus"></span>
                            </div>
                            <div class="api-key-input-group">
                                <input type="password" id="openaiKeyInput" class="form-control" placeholder="sk-...">
                                <button class="btn btn-small btn-primary" id="openaiKeySaveBtn">Save</button>
                                <button class="btn btn-small btn-danger" id="openaiKeyDeleteBtn">Delete</button>
                            </div>
                        </div>

                        <div class="api-key-row">
                            <div class="api-key-provider">
                                <label>Anthropic (Claude)</label>
                                <span class="api-key-status" id="anthropicKeyStatus"></span>
                            </div>
                            <div class="api-key-input-group">
                                <input type="password" id="anthropicKeyInput" class="form-control" placeholder="sk-ant-...">
                                <button class="btn btn-small btn-primary" id="anthropicKeySaveBtn">Save</button>
                                <button class="btn btn-small btn-danger" id="anthropicKeyDeleteBtn">Delete</button>
                            </div>
                        </div>

                        <div class="api-key-row">
                            <div class="api-key-provider">
                                <label>Google Gemini</label>
                                <span class="api-key-status" id="geminiKeyStatus"></span>
                            </div>
                            <div class="api-key-input-group">
                                <input type="password" id="geminiKeyInput" class="form-control" placeholder="AI...">
                                <button class="btn btn-small btn-primary" id="geminiKeySaveBtn">Save</button>
                                <button class="btn btn-small btn-danger" id="geminiKeyDeleteBtn">Delete</button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-info">
                        <h4>Where to get API keys:</h4>
                        <ul>
                            <li><a href="https://platform.openai.com/api-keys" target="_blank">OpenAI API Keys</a></li>
                            <li><a href="https://console.anthropic.com/settings/keys" target="_blank">Anthropic API Keys</a></li>
                            <li><a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio (Gemini)</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- Marked.js for markdown to HTML conversion -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Supabase client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Load Supabase config from API, then load app -->
    <script>
        // Fetch Supabase configuration from API endpoint
        (async function loadConfig() {
            try {
                const configUrl = window.location.hostname === 'localhost'
                    ? 'http://localhost:3000/api/config'
                    : '/api/config';

                const response = await fetch(configUrl);
                if (response.ok) {
                    const config = await response.json();
                    window.SUPABASE_URL = config.supabaseUrl || '';
                    window.SUPABASE_ANON_KEY = config.supabaseAnonKey || '';
                }
            } catch (error) {
                console.warn('Could not load Supabase config. Auth features will be disabled.');
                window.SUPABASE_URL = '';
                window.SUPABASE_ANON_KEY = '';
            }

            // Load app.js after config is ready
            const script = document.createElement('script');
            script.src = 'app.js';
            document.body.appendChild(script);
        })();
    </script>
</body>
</html>
